1. 运行以下命令，查找提交事务的数据，杀掉线程即可解决
   select * from information_schema.innodb_trx;
   kill thread_id;
2. 增加锁等待时间，即增大下面配置项参数值，单位为秒（s）
   innodb_lock_wait_timeout=500 
3. 优化存储过程,事务避免过长时间的等待。



可以用下面三张表来查原因-information_schema：
《select * from information_schema.》
innodb_trx          ## 当前运行的所有事务
innodb_locks        ## 当前出现的锁
innodb_lock_waits   ## 锁等待的对应关系


1.确定是否锁表
select * from information_schema.innodb_locks;
2.查询正在锁的事务
select * from information_schema.innodb_locks;
3.查询等待锁的事务
select * from information_schema.innodb_lock_waits;
4.查询未提交的事务
select * from information_schema.innodb_trx
5.查询所有的线程
select * from information_schema.PROCESSLIST;
————————————————



root@127.0.0.1  : information_schema 13:28:38> desc innodb_locks;
+-------------+---------------------+------+-----+---------+-------+
| Field | Type | Null | Key | Default | Extra |
+-------------+---------------------+------+-----+---------+-------+
| lock_id | varchar(81) | NO | | | |        #锁ID
| lock_trx_id | varchar(18) | NO | | | |    #拥有锁的事务ID
| lock_mode | varchar(32) | NO | | | |      #锁模式
| lock_type | varchar(32) | NO | | | |      #锁类型
| lock_table | varchar(1024) | NO | | | |   #被锁的表
| lock_index | varchar(1024) | YES | | NULL | |         #被锁的索引
| lock_space | bigint(21) unsigned | YES | | NULL | |   #被锁的表空间号
| lock_page | bigint(21) unsigned | YES | | NULL | |    #被锁的页号
| lock_rec | bigint(21) unsigned | YES | | NULL | |     #被锁的记录号
| lock_data | varchar(8192) | YES | | NULL | |          #被锁的数据
+-------------+---------------------+------+-----+---------+-------+
10 rows in set (0.00 sec)

root@127.0.0.1  : information_schema 13:28:56> desc innodb_lock_waits;
+-------------------+-------------+------+-----+---------+-------+
| Field | Type | Null | Key | Default | Extra |
+-------------------+-------------+------+-----+---------+-------+
| requesting_trx_id | varchar(18) | NO | | | |  #请求锁的事务ID
| requested_lock_id | varchar(81) | NO | | | |  #请求锁的锁ID
| blocking_trx_id | varchar(18) | NO | | | |    #当前拥有锁的事务ID
| blocking_lock_id | varchar(81) | NO | | | |   #当前拥有锁的锁ID
+-------------------+-------------+------+-----+---------+-------+
4 rows in set (0.00 sec)

root@127.0.0.1  : information_schema 13:29:05> desc innodb_trx ;
+----------------------------+---------------------+------+-----+---------------------+-------+
| Field | Type | Null | Key | Default | Extra |
+----------------------------+---------------------+------+-----+---------------------+-------+
| trx_id | varchar(18) | NO | | | |             #事务ID
| trx_state | varchar(13) | NO | | | |          #事务状态：
| trx_started | datetime | NO | | 0000-00-00 00:00:00 | |       #事务开始时间；
| trx_requested_lock_id | varchar(81) | YES | | NULL | |        #innodb_locks.lock_id
| trx_wait_started | datetime | YES | | NULL | |                #事务开始等待的时间
| trx_weight | bigint(21) unsigned | NO | | 0 | |               #
| trx_mysql_thread_id | bigint(21) unsigned | NO | | 0 | |      #事务线程ID
| trx_query | varchar(1024) | YES | | NULL | |                  #具体SQL语句
| trx_operation_state | varchar(64) | YES | | NULL | |          #事务当前操作状态
| trx_tables_in_use | bigint(21) unsigned | NO | | 0 | |        #事务中有多少个表被使用
| trx_tables_locked | bigint(21) unsigned | NO | | 0 | |        #事务拥有多少个锁
| trx_lock_structs | bigint(21) unsigned | NO | | 0 | |         #
| trx_lock_memory_bytes | bigint(21) unsigned | NO | | 0 | |    #事务锁住的内存大小（B）
| trx_rows_locked | bigint(21) unsigned | NO | | 0 | |          #事务锁住的行数
| trx_rows_modified | bigint(21) unsigned | NO | | 0 | |        #事务更改的行数
| trx_concurrency_tickets | bigint(21) unsigned | NO | | 0 | |  #事务并发票数
| trx_isolation_level | varchar(16) | NO | | | |                #事务隔离级别
| trx_unique_checks | int(1) | NO | | 0 | |                     #是否唯一性检查
| trx_foreign_key_checks | int(1) | NO | | 0 | |                #是否外键检查
| trx_last_foreign_key_error | varchar(256) | YES | | NULL | |  #最后的外键错误
| trx_adaptive_hash_latched | int(1) | NO | | 0 | |#
| trx_adaptive_hash_timeout | bigint(21) unsigned | NO | | 0 | |#
+----------------------------+---------------------+------+-----+---------------------+-------+
22 rows in set (0.01 sec)



(题外话：
关于set innodb_lock_wait_timeout=1500; 和 set global innodb_lock_wait_timeout=1500;的区别。
前者等价于set session只影响当前session，
后者作为全局的修改方式，只会影响修改之后打开的session；
注意后者不能改变当前session；）
